<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-go-zero/extension/datacenter">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.3.1">
<link rel="alternate" type="application/rss+xml" href="/zerodoc/blog/rss.xml" title="无缘无故~望着我 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zerodoc/blog/atom.xml" title="无缘无故~望着我 Atom Feed">

<script src="https://hm.baidu.com/hm.js?748e7c913214342d8f0706348a9df9f3" async></script><title data-rh="true">go-zero 实现一个中台系统 | 无缘无故~望着我</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://amandayi.github.io/zerodoc/docs/go-zero/extension/datacenter"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="go-zero 实现一个中台系统 | 无缘无故~望着我"><meta data-rh="true" name="description" content="作者：Jack Luo"><meta data-rh="true" property="og:description" content="作者：Jack Luo"><link data-rh="true" rel="canonical" href="https://amandayi.github.io/zerodoc/docs/go-zero/extension/datacenter"><link data-rh="true" rel="alternate" href="https://amandayi.github.io/zerodoc/docs/go-zero/extension/datacenter" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://amandayi.github.io/zerodoc/docs/go-zero/extension/datacenter" hreflang="x-default"><link rel="stylesheet" href="/zerodoc/assets/css/styles.eeff9f6e.css">
<link rel="preload" href="/zerodoc/assets/js/runtime~main.83d6ecb1.js" as="script">
<link rel="preload" href="/zerodoc/assets/js/main.33c2850c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zerodoc/"><div class="navbar__logo"><img src="/zerodoc/img/logo.svg" alt="" class="themedImage_ToTc themedImage--light_HNdA"><img src="/zerodoc/img/logo.svg" alt="" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">ZEROYI</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">技术笔记Note</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zerodoc/docs/js/react/base">react</a></li><li><a class="dropdown__link" href="/zerodoc/docs/js/vue/vue3base">vue</a></li><li><a class="dropdown__link" href="/zerodoc/docs/redis/base">Redis6笔记</a></li><li><a class="dropdown__link" href="/zerodoc/docs/redis/cachepenetration">Redis应用问题</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/zerodoc/docs/go-zero/project/prepare">go-zero微服务文档</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/zerodoc/docs/go-zero/extension/bloom">微服务扩展阅读</a></li><li><a class="dropdown__link" href="/zerodoc/docs/js/typescript/base">TypeScript</a></li><li><a class="dropdown__link" href="/zerodoc/docs/js/design/package">npm库开发</a></li><li><a class="dropdown__link" href="/zerodoc/docs/js/hybird/base">Hybird混合开发原理</a></li><li><a class="dropdown__link" href="/zerodoc/docs/devops/webops">简易持续集成</a></li><li><a class="dropdown__link" href="/zerodoc/docs/wordpress/base">WordPress主题开发</a></li><li><a class="dropdown__link" href="/zerodoc/docs/project/officeOnlineEdit">办公文档多人同步编辑项目</a></li><li><a class="dropdown__link" href="/zerodoc/docs/structure/analyse">声网白板接入</a></li><li><a class="dropdown__link" href="/zerodoc/docs/js/rn/base">react native</a></li><li><a class="dropdown__link" href="/zerodoc/docs/js/webpack/">webpack5核心笔记</a></li><li><a class="dropdown__link" href="/zerodoc/docs/js/webpack3/">webpack常用功能30篇</a></li><li><a class="dropdown__link" href="/zerodoc/docs/js/video/">视频直播技术</a></li><li><a class="dropdown__link" href="/zerodoc/docs/js/normal/">JS常用功能记录</a></li><li><a class="dropdown__link" href="/zerodoc/docs/mysql/join">MySQL</a></li><li><a class="dropdown__link" href="/zerodoc/docs/orm/mybatis/">Mybatis笔记</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">计算机基础知识</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zerodoc/docs/structure/analyse">数据结构与算法</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" positional="left">安全工程</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zerodoc/docs/rsecu/webjs/1">Web逆向工程</a></li></ul></div><a href="https://www.xinwenmh.cn" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">文学<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/zerodoc/project">项目</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/zerodoc/"><img src="/zerodoc/img/logo.svg" alt="" class="themedImage_ToTc themedImage--light_HNdA"><img src="/zerodoc/img/logo.svg" alt="" class="themedImage_ToTc themedImage--dark_i4oU"><b>ZEROYI</b></a><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zerodoc/docs/go-zero/project/prepare">项目开发</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zerodoc/docs/go-zero/quick-start/concept">快速开始</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zerodoc/docs/go-zero/build-tool/tool-intro">构建工具</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zerodoc/docs/go-zero/component/rest">框架组件</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zerodoc/docs/go-zero/ecology/intellij">框架生态</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/zerodoc/docs/go-zero/extension/bloom">扩展阅读</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/bloom">布隆过滤器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/shorturl">快速构建高并发微服务</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/logx">日志组件介绍</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/executors">executors</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/fx">数据流处理组件 fx</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/mysql">go-zero mysql使用介绍</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/redis-lock">redis锁</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/tokenlimit">令牌桶限流</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/timing-wheel">时间轮介绍TimingWheel</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/collection">进程内缓存组件 collection.Cache</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/keywords">高效的关键词替换和敏感词过滤工具</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/mapping">文本序列化和反序列化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/mapreduce">并发处理工具 MapReduce</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/metric">基于prometheus的微服务指标监控</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/sharedcalls">防止缓存击穿之进程内共享调用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/sql-cache">DB缓存机制</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/zrpc">zRPC使用介绍</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/redis-cache">go-zero缓存设计之持久层缓存</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/buiness-cache">go-zero缓存设计之业务层缓存</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/go-queue">go-zero 分布式定时任务</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/go-zero-looklook">使用go-zero开发一个旅游系统go-zero-looklook</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zerodoc/docs/go-zero/extension/datacenter">go-zero 实现一个中台系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/stream">流数据处理利器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/HTTP Middleware">使用 HTTP Middleware</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/gen-jwt">JWT生成</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/get-header">获取用户信息(header)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/get-jwt-info">获取用户信息(jwt鉴权)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/jwt-middleware">JWT鉴权中间件</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/micro-service">微服务开发流程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/online-exchange">微服务重要的问题</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/periodlimit">periodlimit限流</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/self-error">自定义错误返回</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/self-interceptor">自定义拦截器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zerodoc/docs/go-zero/extension/self-sre">自适应熔断中间件</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zerodoc/docs/go-zero/problem/in-use">问题汇总</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/zerodoc/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">扩展阅读</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">go-zero 实现一个中台系统</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>go-zero 实现一个中台系统</h1><blockquote><p>作者：Jack Luo</p><p>原文连接：<a href="https://www.cnblogs.com/jackluo/p/14148518.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/jackluo/p/14148518.html</a></p></blockquote><p>[TOC]</p><p>最近发现golang社区里出了一个新星的微服务框架，来自好未来，光看这个名字，就很有奔头，之前，也只是玩过go-micro，其实真正的还没有在项目中运用过，只是觉得 微服务，grpc 这些很高大尚，还没有在项目中，真正的玩过，我看了一下官方提供的工具真的很好用，只需要定义好，舒适文件jia结构 都生成了，只需要关心业务，加上最近 有个投票的活动，加上最近这几年中台也比较火，所以决定玩一下，</p><blockquote><p>开源地址: <a href="https://github.com/jackluo2012/datacenter" target="_blank" rel="noopener noreferrer">https://github.com/jackluo2012/datacenter</a></p></blockquote><p>先聊聊中台架构思路吧：</p><p><img loading="lazy" src="/zerodoc/assets/images/datacenter-3d2f45899201bfef7eb8ed817f449561.jpg" width="1719" height="1159" class="img_ev3q"></p><p>中台的概念大概就是把一个一个的app 统一起来，反正我是这样理解的。</p><p>先聊用户服务吧，现在一个公司有很多的公众号、小程序、微信的、支付宝的，还有 xxx xxx，很多的平台，每次开发的时候，我们总是需要做用户登陆的服务，不停的复制代码，然后我们就在思考能不能有一套独立的用户服务，只需要告诉我你需要传个你要登陆的平台(比如微信)，微信登陆，需要的是客户端返回给服务端一个code ，然后服务端拿着这个code去微信获取用户信息，反正大家都明白。</p><p>我们决定，将所有的信息弄到配置公共服务中去，里面再存微信、支付宝以及其它平台的appid、appkey、还有支付的appid、appkey，这样就写一套。</p><hr><p>最后说说实现吧，整个就一个repo：</p><ul><li>网关，我们用的是: go-zero的Api服务</li><li>其它它的是服务，我们就是用的go-zero的rpc服务</li></ul><p>看下目录结构</p><p><img loading="lazy" src="/zerodoc/assets/images/datacenter_dir-bb60665994ca261c4bb845d28ac10b2f.png" width="2934" height="1918" class="img_ev3q"></p><p>整个项目完成，我一个人操刀，写了1个来星期，我就实现了上面的中台系统。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="datacenter-api服务">datacenter-api服务<a href="#datacenter-api服务" class="hash-link" aria-label="datacenter-api服务的直接链接" title="datacenter-api服务的直接链接">​</a></h2><p>先看官方文档 <a href="https://go-zero.dev/cn/" target="_blank" rel="noopener noreferrer">https://go-zero.dev/cn/</a></p><p>我们先把网关搭建起来：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">➜ blogs </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> datacenter </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name">cd</span><span class="token plain"> datacenter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜ datacenter go mod init datacenter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go: creating new go.mod: module datacenter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜ datacenter</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>查看book目录：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">➜  datacenter tree</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── go.mod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 directories, 1 file</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="创建api文件">创建api文件<a href="#创建api文件" class="hash-link" aria-label="创建api文件的直接链接" title="创建api文件的直接链接">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">➜  datacenter goctl api -o datacenter.api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Done.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜  datacenter tree</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── datacenter.api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── user.api  #用户</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── votes.api #投票</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── search.api #搜索</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── questions.api #问答</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── go.mod</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="定义api服务">定义api服务<a href="#定义api服务" class="hash-link" aria-label="定义api服务的直接链接" title="定义api服务的直接链接">​</a></h3><p>分别包含了上面的 <strong>公共服务</strong>，<strong>用户服务</strong>，<strong>投票活动服务</strong></p><p>datacenter.api的内容:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">info(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    title: &quot;中台系统&quot;// TODO: add title</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    desc: &quot;中台系统&quot;// TODO: add description</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    author: &quot;jackluo&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    email: &quot;net.webjoy@gmail.com&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;user.api&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;votes.api&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;search.api&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;questions.api&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//获取 应用信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type Beid {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Beid int64 `json:&quot;beid&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type Token {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Token string `json:&quot;token&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type WxTicket {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ticket string `json:&quot;ticket&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type Application {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Sname       string `json:&quot;Sname&quot;`       //名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Logo        string `json:&quot;logo&quot;`        // login</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Isclose     int64  `json:&quot;isclose&quot;`     //是否关闭</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Fullwebsite string `json:&quot;fullwebsite&quot;` // 全站名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type SnsReq {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Beid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ptyid   int64  `json:&quot;ptyid&quot;`    //对应平台</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BackUrl string `json:&quot;back_url&quot;` //登陆返回的地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type SnsResp {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Beid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ptyid    int64  `json:&quot;ptyid&quot;`     //对应平台</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Appid    string `json:&quot;appid&quot;`     //sns 平台的id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Title    string `json:&quot;title&quot;`     //名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LoginUrl string `json:&quot;login_url&quot;` //微信登陆的地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type WxShareResp {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Appid     string `json:&quot;appid&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Timestamp int64  `json:&quot;timestamp&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Noncestr  string `json:&quot;noncestr&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Signature string `json:&quot;signature&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@server(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    group: common</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service datacenter-api {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @doc(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        summary: &quot;获取站点的信息&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @handler appInfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    get /common/appinfo (Beid) returns (Application)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @doc(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        summary: &quot;获取站点的社交属性信息&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @handler snsInfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    post /common/snsinfo (SnsReq) returns (SnsResp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //获取分享的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @handler wxTicket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    post /common/wx/ticket (SnsReq) returns (WxShareResp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//上传需要登陆</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@server(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jwt: Auth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    group: common</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service datacenter-api {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @doc(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        summary: &quot;七牛上传凭证&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @handler qiuniuToken</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    post /common/qiuniu/token (Beid) returns (Token)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>user.api内容</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//注册请求</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type RegisterReq struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // TODO: add members here and delete this comment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Mobile   string `json:&quot;mobile&quot;` //基本一个手机号码就完事</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Password string `json:&quot;password&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Smscode string `json:&quot;smscode&quot;` //短信码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//登陆请求</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type LoginReq struct{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Mobile   string `json:&quot;mobile&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type int64 `json:&quot;type&quot;`    //1.密码登陆，2.短信登陆</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Password string `json:&quot;password&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//微信登陆</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type WxLoginReq struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Beid      int64  `json:&quot;beid&quot;` //应用id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Code string `json:&quot;code&quot;` //微信登陆密钥</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ptyid     int64  `json:&quot;ptyid&quot;` //对应平台</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//返回用户信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type UserReply struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Auid       int64  `json:&quot;auid&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Uid       int64  `json:&quot;uid&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Beid      int64  `json:&quot;beid&quot;` //应用id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ptyid     int64  `json:&quot;ptyid&quot;` //对应平台</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Username string `json:&quot;username&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Mobile   string `json:&quot;mobile&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Nickname string `json:&quot;nickname&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Openid string `json:&quot;openid&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Avator string `json:&quot;avator&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    JwtToken</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//返回APPUser</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type AppUser struct{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Uid       int64  `json:&quot;uid&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Auid       int64  `json:&quot;auid&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Beid      int64  `json:&quot;beid&quot;` //应用id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ptyid     int64  `json:&quot;ptyid&quot;` //对应平台</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Nickname string `json:&quot;nickname&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Openid string `json:&quot;openid&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Avator string `json:&quot;avator&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type LoginAppUser struct{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Uid       int64  `json:&quot;uid&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Auid       int64  `json:&quot;auid&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Beid      int64  `json:&quot;beid&quot;` //应用id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ptyid     int64  `json:&quot;ptyid&quot;` //对应平台</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Nickname string `json:&quot;nickname&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Openid string `json:&quot;openid&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Avator string `json:&quot;avator&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    JwtToken</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type JwtToken struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AccessToken  string `json:&quot;access_token,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AccessExpire int64  `json:&quot;access_expire,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RefreshAfter int64  `json:&quot;refresh_after,omitempty&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type UserReq struct{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Auid       int64  `json:&quot;auid&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Uid       int64  `json:&quot;uid&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Beid      int64  `json:&quot;beid&quot;` //应用id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ptyid     int64  `json:&quot;ptyid&quot;` //对应平台</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type Request {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Name string `path:&quot;name,options=you|me&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Message string `json:&quot;message&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@server(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    group: user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service datacenter-api {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @handler ping</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    post /user/ping ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @handler register</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    post /user/register (RegisterReq) returns (UserReply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @handler login</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    post /user/login (LoginReq) returns (UserReply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @handler wxlogin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    post /user/wx/login (WxLoginReq) returns (LoginAppUser)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @handler code2Session</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    get /user/wx/login () returns (LoginAppUser)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@server(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jwt: Auth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    group: user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    middleware: Usercheck</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service datacenter-api {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @handler userInfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    get /user/dc/info (UserReq) returns (UserReply)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>votes.api 投票内容</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 投票活动api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type Actid struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Actid       int64  `json:&quot;actid&quot;` //活动id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type VoteReq struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Aeid       int64  `json:&quot;aeid&quot;` // 作品id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Actid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type VoteResp struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    VoteReq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Votecount       int64  `json:&quot;votecount&quot;` //投票票数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Viewcount       int64  `json:&quot;viewcount&quot;` //浏览数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 活动返回的参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type ActivityResp struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Actid           int64  `json:&quot;actid&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Title           string  `json:&quot;title&quot;` //活动名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Descr           string  `json:&quot;descr&quot;` //活动描述</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    StartDate       int64  `json:&quot;start_date&quot;` //活动时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    EnrollDate      int64  `json:&quot;enroll_date&quot;` //投票时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    EndDate         int64  `json:&quot;end_date&quot;` //活动结束时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Votecount       int64  `json:&quot;votecount&quot;` //当前活动的总票数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Viewcount       int64  `json:&quot;viewcount&quot;` //当前活动的总浏览数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type            int64 `json:&quot;type&quot;` //投票方式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Num             int64 `json:&quot;num&quot;` //投票几票</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//报名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type EnrollReq struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Actid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Name        string  `json:&quot;name&quot;` // 名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Address         string  `json:&quot;address&quot;` //地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Images          []string  `json:&quot;images&quot;` //作品图片</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Descr           string  `json:&quot;descr&quot;` // 作品描述</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 作品返回</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type EnrollResp struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Actid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Aeid        int64 `json:&quot;aeid&quot;` // 作品id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Name        string  `json:&quot;name&quot;` // 名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Address         string  `json:&quot;address&quot;` //地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Images          []string  `json:&quot;images&quot;` //作品图片</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Descr           string  `json:&quot;descr&quot;` // 作品描述</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Votecount       int64  `json:&quot;votecount&quot;` //当前活动的总票数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Viewcount       int64  `json:&quot;viewcount&quot;` //当前活动的总浏览数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@server(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    group: votes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service datacenter-api {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @doc(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        summary: &quot;获取活动的信息&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @handler activityInfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    get /votes/activity/info (Actid) returns (ActivityResp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @doc(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        summary: &quot;活动访问+1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @handler activityIcrView</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    get /votes/activity/view (Actid) returns (ActivityResp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @doc(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        summary: &quot;获取报名的投票作品信息&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @handler enrollInfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    get /votes/enroll/info (VoteReq) returns (EnrollResp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @doc(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        summary: &quot;获取报名的投票作品列表&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @handler enrollLists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    get /votes/enroll/lists (Actid) returns(EnrollResp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@server(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jwt: Auth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    group: votes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    middleware: Usercheck</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service datacenter-api {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @doc(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        summary: &quot;投票&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @handler vote</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    post /votes/vote (VoteReq) returns (VoteResp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @handler enroll</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    post /votes/enroll (EnrollReq) returns (EnrollResp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>questions.api 问答内容:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 问答 抽奖 开始</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@server(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    group: questions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service datacenter-api {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @doc(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        summary: &quot;获取活动的信息&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @handler activitiesInfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    get /questions/activities/info (Actid) returns (ActivityResp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @doc(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        summary: &quot;获取奖品信息&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @handler awardInfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    get /questions/award/info (Actid) returns (ActivityResp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @handler awardList</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    get /questions/award/list (Actid) returns (ActivityResp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type AnswerReq struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ActivityId  int64 `json:&quot;actid&quot;` </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Answers string `json:&quot;answers&quot;` </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Score   string `json:&quot;score&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type QuestionsAwardReq struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ActivityId  int64 `json:&quot;actid&quot;` </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AnswerId    int64 `json:&quot;answerid&quot;` </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type AnswerResp struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Answers string `json:&quot;answers&quot;` </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Score   string `json:&quot;score&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type AwardConvertReq struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    UserName    string `json:&quot;username&quot;` </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Phone       string `json:&quot;phone&quot;` </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LotteryId   int64 `json:&quot;lotteryid&quot;` </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@server(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jwt: Auth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    group: questions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    middleware: Usercheck</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service datacenter-api {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @doc(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        summary: &quot;获取题目&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @handler lists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    get /questions/lists (VoteReq) returns (AnswerResp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @doc(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        summary: &quot;提交答案&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @handler change</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    post /questions/change (AnswerReq) returns (VoteResp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @doc(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        summary: &quot;获取分数&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @handler grade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    get /questions/grade (VoteReq) returns (VoteResp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @doc(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        summary: &quot;开始转盘&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @handler turntable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    post /questions/lottery/turntable (EnrollReq) returns (EnrollResp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @doc(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        summary: &quot;填写中奖信息人&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @handler lottery</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    post /questions/lottery/convert (AwardConvertReq) returns (EnrollResp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 问答 抽奖 结束</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>search.api 搜索</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type SearchReq struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Keyword string `json:&quot;keyword&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Page string `json:&quot;page&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Size string `json:&quot;size&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type SearchResp struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Data []ArticleReq `json:&quot;data&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type ArticleReq struct{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    NewsId string `json:&quot;NewsId&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    NewsTitle string `json:&quot;NewsTitle&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ImageUrl string `json:&quot;ImageUrl&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@server(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    group: search</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    middleware: Admincheck</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service datacenter-api {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @doc(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        summary: &quot;搜索&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @handler article</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    get /search/article (SearchReq) returns (SearchResp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @handler articleInit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    get /search/articel/init (SearchReq) returns (SearchResp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @handler articleStore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    post /search/articel/store (ArticleReq) returns (ArticleReq)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上面基本上写就写的API及文档的思路</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="生成datacenter-api服务">生成datacenter api服务<a href="#生成datacenter-api服务" class="hash-link" aria-label="生成datacenter api服务的直接链接" title="生成datacenter api服务的直接链接">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">➜  datacenter goctl api go -api datacenter.api -dir .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Done.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜  datacenter treer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── datacenter.api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── etc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── datacenter-api.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── go.mod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── internal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   └── config.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   ├── common</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   │   ├── appinfohandler.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   │   ├── qiuniutokenhandler.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   │   ├── snsinfohandler.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   │   ├── votesverificationhandler.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   │   └── wxtickethandler.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   ├── routes.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   ├── user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   │   ├── code2sessionhandler.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   │   ├── loginhandler.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   │   ├── pinghandler.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   │   ├── registerhandler.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   │   ├── userinfohandler.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   │   └── wxloginhandler.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   └── votes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │       ├── activityicrviewhandler.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │       ├── activityinfohandler.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │       ├── enrollhandler.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │       ├── enrollinfohandler.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │       ├── enrolllistshandler.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │       └── votehandler.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── logic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   ├── common</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   │   ├── appinfologic.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   │   ├── qiuniutokenlogic.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   │   ├── snsinfologic.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   │   ├── votesverificationlogic.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   │   └── wxticketlogic.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   ├── user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   │   ├── code2sessionlogic.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   │   ├── loginlogic.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   │   ├── pinglogic.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   │   ├── registerlogic.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   │   ├── userinfologic.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   │   └── wxloginlogic.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   └── votes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │       ├── activityicrviewlogic.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │       ├── activityinfologic.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │       ├── enrollinfologic.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │       ├── enrolllistslogic.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │       ├── enrolllogic.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │       └── votelogic.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── middleware</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   └── usercheckmiddleware.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── svc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   └── servicecontext.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── types</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       └── types.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── datacenter.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">14 directories, 43 files</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们打开 <code>etc/datacenter-api.yaml</code> 把必要的配置信息加上</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">Name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> datacenter</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">Log</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">Mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> console</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">Host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 0.0.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">Port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8857</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">Auth</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">AccessSecret</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 你的jwtwon Secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">AccessExpire</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">86400</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">CacheRedis</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">Host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 127.0.0.1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">6379</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">Pass</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 密码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">Type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> node                     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">UserRpc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">Etcd</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 127.0.0.1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2379</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> user.rpc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">CommonRpc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">Etcd</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 127.0.0.1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2379</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> common.rpc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">VotesRpc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">Etcd</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 127.0.0.1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2379</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> votes.rpc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上面的 <code>UserRpc</code>， <code>CommonRpc</code> ,还有 <code>VotesRpc</code> 这些我先写上，后面再来慢慢加。</p><p>我们先来写 <code>CommonRpc</code> 服务。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="commonrpc服务">CommonRpc服务<a href="#commonrpc服务" class="hash-link" aria-label="CommonRpc服务的直接链接" title="CommonRpc服务的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="新建项目目录">新建项目目录<a href="#新建项目目录" class="hash-link" aria-label="新建项目目录的直接链接" title="新建项目目录的直接链接">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">➜  datacenter mkdir -p common/rpc &amp;&amp; cd common/rpc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>直接就新建在了，datacenter目录中，因为common 里面，可能以后会不只会提供rpc服务，可能还有api的服务,所以又加了rpc目录</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="goctl创建模板">goctl创建模板<a href="#goctl创建模板" class="hash-link" aria-label="goctl创建模板的直接链接" title="goctl创建模板的直接链接">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">➜  rpc goctl rpc template -o=common.proto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜  rpc ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">common.proto</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>往里面填入内容：</p><div class="language-protobufbuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobufbuf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">➜  rpc cat common.proto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">syntax = &quot;proto3&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">option go_package = &quot;common&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package common;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message BaseAppReq{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int64 beid=1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message BaseAppResp{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int64 beid=1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string logo=2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string sname=3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int64 isclose=4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string fullwebsite=5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 请求的api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message AppConfigReq {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int64 beid=1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int64 ptyid=2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 返回的值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message AppConfigResp {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int64 id=1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int64 beid=2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int64 ptyid=3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string appid=4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string appsecret=5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string title=6;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service Common {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc GetAppConfig(AppConfigReq) returns(AppConfigResp);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc GetBaseApp(BaseAppReq) returns(BaseAppResp);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="gotcl生成rpc服务">gotcl生成rpc服务<a href="#gotcl生成rpc服务" class="hash-link" aria-label="gotcl生成rpc服务的直接链接" title="gotcl生成rpc服务的直接链接">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">➜  rpc goctl rpc proto -src common.proto -dir </span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">protoc  -I</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/Users/jackluo/works/blogs/datacenter/common/rpc common.proto --go_out</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">plugins</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">grpc:/Users/jackluo/works/blogs/datacenter/common/rpc/common</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Done.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">➜ rpc tree</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── common</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └── common.pb.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── common.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── common.proto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── commonclient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └── common.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── etc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └── common.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── internal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └── config.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── logic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ├── getappconfiglogic.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └── getbaseapplogic.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └── commonserver.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── svc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── servicecontext.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8 directories, 10 files</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>基本上，就把所有的目录规范和结构的东西都生成了，就不用纠结项目目录了，怎么放了，怎么组织了。</p><p>看一下，配置信息，里面可以写入mysql和其它redis的信息：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">Name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> common.rpc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">ListenOn</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 127.0.0.1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8081</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">Mysql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">DataSource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">admin@tcp(127.0.0.1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">3306)/datacenter</span><span class="token punctuation" style="color:#393A34">?</span><span class="token plain">charset=utf8</span><span class="token important">&amp;parseTime=true&amp;loc=Asia%2FShanghai</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">CacheRedis</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">Host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 127.0.0.1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">6379</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">Pass</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">Type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> node  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">Etcd</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">Hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 127.0.0.1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2379</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">Key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> common.rpc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们再来加上数据库服务：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">➜  rpc cd ..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜  common ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜  common pwd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/Users/jackluo/works/blogs/datacenter/common</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜  common goctl model mysql datasource -url=&quot;root:admin@tcp(127.0.0.1:3306)/datacenter&quot; -table=&quot;base_app&quot; -dir ./model -c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Done.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜  common tree</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── baseappmodel.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── vars.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── rpc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── common</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   └── common.pb.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── common.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── common.proto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── commonclient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   └── common.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── etc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   └── common.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── internal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   └── config.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── logic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   ├── getappconfiglogic.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   └── getbaseapplogic.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   └── commonserver.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        └── svc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            └── servicecontext.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10 directories, 12 files</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这样基本的一个 <code>rpc</code> 就写完了，然后我们将rpc 和model 还有api串连起来，这个官方的文档已经很详细了，这里就只是贴一下代码：</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">➜  common cat rpc</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">internal</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">config</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">go</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/zeromicro/go-zero/core/stores/cache&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/zeromicro/go-zero/zrpc&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Config </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    zrpc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RpcServerConf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Mysql </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DataSource </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CacheRedis cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ClusterConf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>再在svc中修改：</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">➜  common cat rpc</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">internal</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">svc</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">servicecontext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">go</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> svc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;datacenter/common/model&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;datacenter/common/rpc/internal/config&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/zeromicro/go-zero/core/stores/sqlx&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> ServiceContext </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c              config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AppConfigModel model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AppConfigModel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BaseAppModel   model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">BaseAppModel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">NewServiceContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">ServiceContext </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    conn </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> sqlx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewMysql</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Mysql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataSource</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    apm </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewAppConfigModel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conn</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CacheRedis</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bam </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewBaseAppModel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conn</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CacheRedis</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ServiceContext</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">              c</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AppConfigModel</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apm</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        BaseAppModel</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">   bam</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上面的代码已经将 <code>rpc</code> 和 <code>model</code> 数据库关联起来了，我们现在再将 <code>rpc</code> 和 <code>api</code> 关联起来：</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">➜  datacenter cat internal</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">config</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">go</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/zeromicro/go-zero/core/stores/cache&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/zeromicro/go-zero/rest&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/zeromicro/go-zero/zrpc&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Config </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rest</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RestConf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Auth </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AccessSecret </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AccessExpire </span><span class="token builtin">int64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    UserRpc   zrpc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RpcClientConf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CommonRpc zrpc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RpcClientConf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    VotesRpc  zrpc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RpcClientConf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CacheRedis cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ClusterConf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>加入 <code>svc</code> 服务中：</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">➜  datacenter cat internal</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">svc</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">servicecontext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">go</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> svc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;context&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;datacenter/common/rpc/commonclient&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;datacenter/internal/config&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;datacenter/internal/middleware&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;datacenter/shared&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;datacenter/user/rpc/userclient&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;datacenter/votes/rpc/votesclient&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;fmt&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;net/http&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;time&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/zeromicro/go-zero/core/logx&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/zeromicro/go-zero/core/stores/cache&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/zeromicro/go-zero/core/stores/redis&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/zeromicro/go-zero/core/syncx&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/zeromicro/go-zero/rest&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/zeromicro/go-zero/zrpc&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;google.golang.org/grpc&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> ServiceContext </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Config           config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GreetMiddleware1 rest</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Middleware</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GreetMiddleware2 rest</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Middleware</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Usercheck        rest</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Middleware</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    UserRpc          userclient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">User </span><span class="token comment" style="color:#999988;font-style:italic">//用户</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CommonRpc        commonclient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Common</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    VotesRpc         votesclient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Votes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Cache            cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RedisConn        </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">redis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Redis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">timeInterceptor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> method </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> req</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> reply </span><span class="token keyword" style="color:#00009f">interface</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cc </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">grpc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ClientConn</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> invoker grpc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UnaryInvoker</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> opts </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">grpc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CallOption</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stime </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">invoker</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> method</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> req</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> reply</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> opts</span><span class="token operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;调用 %s 方法 耗时: %v\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> method</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Sub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">stime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">NewServiceContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">ServiceContext </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ur </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> userclient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">zrpc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">MustNewClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UserRpc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> zrpc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">WithUnaryClientInterceptor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timeInterceptor</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cr </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> commonclient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewCommon</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">zrpc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">MustNewClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CommonRpc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> zrpc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">WithUnaryClientInterceptor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timeInterceptor</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vr </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> votesclient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewVotes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">zrpc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">MustNewClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">VotesRpc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> zrpc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">WithUnaryClientInterceptor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timeInterceptor</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//缓存</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ca </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewCache</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CacheRedis</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> syncx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewSharedCalls</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewCacheStat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;dc&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> shared</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ErrNotFound</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rcon </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> redis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewRedis</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CacheRedis</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Host</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CacheRedis</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CacheRedis</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Pass</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ServiceContext</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">           c</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        GreetMiddleware1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> greetMiddleware1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        GreetMiddleware2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> greetMiddleware2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Usercheck</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">        middleware</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewUserCheckMiddleware</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Handle</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        UserRpc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">          ur</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CommonRpc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">        cr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        VotesRpc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">         vr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Cache</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">            ca</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        RedisConn</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">        rcon</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这样基本上，我们就可以在 <code>logic</code> 的文件目录中调用了：</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat internal</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">logic</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">common</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">appinfologic</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">go</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> logic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;context&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;datacenter/internal/svc&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;datacenter/internal/types&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;datacenter/shared&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;datacenter/common/model&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;datacenter/common/rpc/common&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;github.com/zeromicro/go-zero/core/logx&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> AppInfoLogic </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    logx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Logger</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ctx    context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Context</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    svcCtx </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">svc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ServiceContext</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">NewAppInfoLogic</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> svcCtx </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">svc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ServiceContext</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> AppInfoLogic </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> AppInfoLogic</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Logger</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> logx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">WithContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ctx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">    ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        svcCtx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> svcCtx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">l </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">AppInfoLogic</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">AppInfo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">req types</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Beid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">appconfig </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">common</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">BaseAppResp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//检查 缓存中是否有值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    err </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> l</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">svcCtx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetCache</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetcacheBaseAppIdPrefix</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">req</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Beid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> appconfig</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> shared</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ErrNotFound </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        appconfig</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> l</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">svcCtx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CommonRpc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetBaseApp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">l</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">common</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">BaseAppReq</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Beid</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> req</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Beid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        err </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> l</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">svcCtx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">SetCache</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetcacheBaseAppIdPrefix</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">req</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Beid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> appconfig</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这样，基本就连接起来了，其它基本上就不用改了，<code>UserRPC</code>， <code>VotesRPC</code> 类似，这里就不在写了。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用心得">使用心得<a href="#使用心得" class="hash-link" aria-label="使用心得的直接链接" title="使用心得的直接链接">​</a></h2><p><code>go-zero</code> 的确香，因为它有一个 <code>goctl</code> 的工具，他可以自动的把代码结构全部的生成好，我们就不再去纠结，目录结构 ，怎么组织，没有个好几年的架构能力是不好实现的，有什么规范那些，并发，熔断，完全不用，考虑其它的，专心的实现业务就好，像微服务，还要有服务发现，一系列的东西，都不用关心，因为 <code>go-zero</code> 内部已经实现了。</p><p>我写代码也写了有10多年了，之前一直用的 php，比较出名的就 laravel，thinkphp，基本上就是模块化的，像微服务那些实现真的有成本，但是你用上go-zero，你就像调api接口一样简单的开发，其它什么服务发现，那些根本就不用关注了，只需要关注业务。</p><p>一个好的语言，框架，他们的底层思维，永远都是效率高，不加班的思想，我相信go-zero会提高你和你团队或是公司的效率。go-zero的作者说，他们有个团队专门整理go-zero框架，目的也应该很明显，那就是提高，他们自己的开发效率，流程化，标准化，是提高工作效率的准则，像我们平时遇到了问题，或是遇到了bug，我第一个想到的不是怎么去解决我的bug，而是在想我的流程是不是有问题，我的哪个流程会导致bug，最后我相信 <code>go-zero</code> 能成为 <strong>微服务开发</strong> 的首选框架。</p><p>最后说说遇到的坑吧：</p><ul><li><code>grpc</code></li></ul><p><code>grpc</code> 本人第一次用，然后就遇到了，有些字符为空时，字段值不显示的问题：</p><p>通过 <code>grpc</code> 官方库中的 <code>jsonpb</code> 来实现，官方在它的设定中有一个结构体用来实现 <code>protoc buffer</code> 转换为JSON结构，并可以根据字段来配置转换的要求。</p><ul><li>跨域问题</li></ul><p><code>go-zero</code> 中设置了，感觉没有效果，大佬说通过nginx 设置，后面发现还是不行，最近强行弄到了一个域名下，后面有时间再解决。</p><ul><li><code>sqlx</code></li></ul><p><code>go-zero</code> 的 <code>sqlx</code> 问题，这个真的费了很长的时间：</p><blockquote><p><code>time.Time</code> 这个数据结构，数据库中用的是 timestamp 这个 比如我的字段 是delete_at 默认数库设置的是null ，结果插入的时候，就报了 <code>Incorrect datetime value: &#x27;0000-00-00&#x27; for column &#x27;deleted_at&#x27; at row 1&quot;}</code> 这个错，查询的时候报 <code>deleted_at\&quot;: unsupported Scan, storing driver.Value type \u003cnil\u003e into type *time.Time&quot;</code>
后面果断去掉了这个字段，字段上面加上 <code>.omitempty</code> 这个标签，好像也有用，<code>db:&quot;.omitempty&quot;</code></p></blockquote><p>其次就是这个 <code>Conversion from collation utf8_general_ci into utf8mb4_unicode_ci</code>，这个导致的大概原因是，现在都喜欢用emj表情了，mysql数据识别不了。</p><ul><li>数据连接</li></ul><p><code>mysql</code> 这边照样按照原始的方式,将配置文件修改编码格式，重新创建数据库，并且设置数据库编码为utf8mb4，排序规则为 <code>utf8mb4_unicode_ci</code>。</p><p><strong>这样的话,所有的表还有string字段都是这个编码格式,如果不想所有的都是,可以单独设置,这个不是重点.因为在navicat上都好设置,手动点一下就行了</strong>。</p><p>重点来了：golang中使用的是 <code>github.com/go-sql-driver/mysql</code> 驱动，将连接 <code>mysql</code>的 <code>dsn</code>（因为我这使用的是gorm，所以dsn可能跟原生的格式不太一样，不过没关系， 只需要关注 <code>charset</code> 和 <code>collation</code> 就行了）
<code>root:password@/name?parseTime=True&amp;loc=Local&amp;charset=utf8</code> 修改为：
<code>root:password@/name?parseTime=True&amp;loc=Local&amp;charset=utf8mb4&amp;collation=utf8mb4_unicode_ci</code></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/zerodoc/docs/go-zero/extension/go-zero-looklook"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">使用go-zero开发一个旅游系统go-zero-looklook</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zerodoc/docs/go-zero/extension/stream"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">流数据处理利器</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#datacenter-api服务" class="table-of-contents__link toc-highlight">datacenter-api服务</a><ul><li><a href="#创建api文件" class="table-of-contents__link toc-highlight">创建api文件</a></li><li><a href="#定义api服务" class="table-of-contents__link toc-highlight">定义api服务</a></li><li><a href="#生成datacenter-api服务" class="table-of-contents__link toc-highlight">生成datacenter api服务</a></li></ul></li><li><a href="#commonrpc服务" class="table-of-contents__link toc-highlight">CommonRpc服务</a><ul><li><a href="#新建项目目录" class="table-of-contents__link toc-highlight">新建项目目录</a></li><li><a href="#goctl创建模板" class="table-of-contents__link toc-highlight">goctl创建模板</a></li><li><a href="#gotcl生成rpc服务" class="table-of-contents__link toc-highlight">gotcl生成rpc服务</a></li></ul></li><li><a href="#使用心得" class="table-of-contents__link toc-highlight">使用心得</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">探索</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zerodoc/docs/js/design/package">前端通用工具库设计开发</a></li><li class="footer__item"><a class="footer__link-item" href="/zerodoc/docs/project/officeOnlineEdit">金山文档在线编辑接入</a></li><li class="footer__item"><a class="footer__link-item" href="/zerodoc/docs/devops/webops">纯静态文件的持续集成发布</a></li></ul></div><div class="col footer__col"><div class="footer__title">基础知识</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zerodoc/docs/js/typescript/base">TypeScript</a></li><li class="footer__item"><a class="footer__link-item" href="/zerodoc/docs/redis/transaction">Redis事务与锁</a></li><li class="footer__item"><a class="footer__link-item" href="/zerodoc/docs/js/webpack3/01">webpack常用功能30篇</a></li></ul></div><div class="col footer__col"><div class="footer__title">计算机</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zerodoc/docs/structure/analyse">数据结构与算法</a></li></ul></div><div class="col footer__col"><div class="footer__title">VDom</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zerodoc/docs/js/react/base">React</a></li><li class="footer__item"><a class="footer__link-item" href="/zerodoc/docs/js/vue/vue3base">Vue</a></li></ul></div><div class="col footer__col"><div class="footer__title">其他</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://regexper.com/" target="_blank" rel="nofollow noopener noreferrer" class="footer__link-item">正则表达式流程图转换<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://sentinelguard.io/zh-cn/index.html" target="_blank" rel="nofollow noopener noreferrer" class="footer__link-item">分布式流量控制组件<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
								<div>以生死为此岸，涅槃为彼岸，此岸苦苦挣扎，彼岸超然洒脱。</div>
								<!-- <div>Copy right © 2024  Inc. By ZeroYi</div> -->
<!--								<div><a href="https://beian.miit.gov.cn/" target="_blank" class="footer__link-item">豫ICP备2023031390号-1</a></div>-->
							</div></div></div></footer></div>
<script src="/zerodoc/assets/js/runtime~main.83d6ecb1.js"></script>
<script src="/zerodoc/assets/js/main.33c2850c.js"></script>
</body>
</html>